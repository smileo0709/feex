<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>FEEx â€” Future Event Exchange</title>
  <style>
    :root{
      --bg:#000; --panel:#0b0b0b; --panel2:#111; --text:#e7e7e7; --muted:#9aa0a6;
      --line:#222; --blue:#1d9bf0; --red:#ff4d4f; --green:#21c55d; --chip:#16181c;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --w: 1100px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",Arial}
    a{color:inherit}
    button,input,select,textarea{font:inherit}
    .app{min-height:100vh;display:flex;justify-content:center}
    .wrap{width:100%;max-width:var(--w);display:grid;grid-template-columns: 280px 1fr 340px;gap:14px;padding:14px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .left,.mid,.right{min-height:40px}
    .left .card,.right .card{position:sticky;top:14px}
    .nav{padding:12px}
    .brand{display:flex;align-items:center;gap:10px;padding:10px 10px 14px}
    .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,#1d9bf0,#7c3aed)}
    .brand b{font-size:18px}
    .nav a,.nav button{display:flex;gap:10px;align-items:center;width:100%;padding:10px 12px;border-radius:12px;text-decoration:none;border:0;background:transparent;color:var(--text);cursor:pointer}
    .nav a:hover,.nav button:hover{background:var(--panel2)}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--line);color:var(--muted);font-size:12px}
    .muted{color:var(--muted)}
    .danger{color:var(--red)}
    .ok{color:var(--green)}
    .btn{border:1px solid var(--line);background:var(--panel2);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer}
    .btn:hover{border-color:#333}
    .btn.primary{background:var(--blue);border-color:transparent;color:#000;font-weight:700}
    .btn.primary:hover{filter:brightness(1.03)}
    .btn.ghost{background:transparent}
    .btn.small{padding:7px 10px;border-radius:10px;font-size:13px}
    .input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#000;color:var(--text)}
    .row{display:flex;gap:10px;align-items:center}
    .col{display:flex;flex-direction:column;gap:10px}
    .sep{height:1px;background:var(--line);margin:10px 0}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:transparent;color:var(--text);cursor:pointer}
    .tab.active{background:var(--chip)}
    .midHeader{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .midHeader h1{margin:0;font-size:18px}
    .subtabs{display:flex;gap:8px;flex-wrap:wrap}
    .feed{padding:0}
    .post{padding:14px;border-bottom:1px solid var(--line);display:grid;grid-template-columns:44px 1fr;gap:10px}
    .avatar{width:44px;height:44px;border-radius:999px;background:#222}
    .postTop{display:flex;justify-content:space-between;gap:10px}
    .nick{font-weight:800}
    .meta{color:var(--muted);font-size:12px}
    .title{margin:6px 0 8px;font-size:15px;line-height:1.35}
    .cover{width:100%;aspect-ratio:1/1;max-height:360px;border-radius:16px;border:1px solid var(--line);background:#050505;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .actions{display:flex;gap:14px;align-items:center;margin-top:10px;color:var(--muted);font-size:13px}
    .actionBtn{border:0;background:transparent;color:inherit;cursor:pointer;padding:6px 8px;border-radius:10px}
    .actionBtn:hover{background:var(--panel2)}
    .twolines{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .more{color:var(--blue);cursor:pointer}
    .rightBox{padding:12px}
    .rightBox h3{margin:0 0 10px;font-size:14px}
    .tagGrid{display:flex;gap:8px;flex-wrap:wrap}
    .tag{padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:transparent;cursor:pointer}
    .tag.active{background:var(--chip)}
    .modalBackdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:14px;z-index:50}
    .modal{width:min(560px,100%);background:var(--panel);border:1px solid var(--line);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
    .modalHeader{padding:12px 14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .modalHeader b{font-size:15px}
    .modalBody{padding:14px}
    .notice{padding:10px 12px;border-radius:12px;background:#0a0a0a;border:1px solid #202020;color:var(--muted);font-size:13px}
    .err{border-color:rgba(255,77,79,.35);color:#ffd1d1;background:rgba(255,77,79,.06)}
    .okbox{border-color:rgba(33,197,93,.35);color:#d7ffe7;background:rgba(33,197,93,.06)}
    .hide{display:none !important;}

    /* mobile */
    @media (max-width: 980px){
      .wrap{grid-template-columns: 82px 1fr; }
      .right{display:none;}
      .navText{display:none;}
      .brand b{display:none;}
      .nav a,.nav button{justify-content:center;}
    }
    @media (max-width: 640px){
      .wrap{grid-template-columns: 1fr; padding:10px}
      .left{display:none;}
      .right{display:none;}
      .card{border-radius:14px}
    }
  </style>
</head>

<body>
<div class="app">
  <div class="wrap">

    <!-- LEFT NAV -->
    <div class="left">
      <div class="card nav">
        <div class="brand">
          <div class="logo"></div>
          <b>FEEx</b>
        </div>
        <button onclick="go('feed')"><span>ğŸ </span><span class="navText">é¦–é </span></button>
        <button onclick="go('predict')"><span>ğŸ”®</span><span class="navText">æœªä¾†äº‹ä»¶é æ¸¬</span></button>
        <button onclick="go('publish')"><span>ğŸª™</span><span class="navText">çœ‹å»£å‘Šæ‹¿é‡‘å¹£</span></button>
        <button onclick="go('profile')"><span>ğŸ‘¤</span><span class="navText">å€‹äººæª”æ¡ˆ</span></button>
        <button onclick="go('rules')"><span>ğŸ“œ</span><span class="navText">è¦å‰‡ & è¨­å®š</span></button>
        <div class="sep"></div>
        <button class="btn primary" onclick="openAuth()">ç™»å…¥ / è¨»å†Š</button>
        <button class="btn ghost" onclick="logout()">ç™»å‡º</button>
        <div class="sep"></div>
        <div class="pill">API: <span id="apiBase"></span></div>
        <div class="pill">ç‹€æ…‹: <span id="statusText" class="muted">æœªç™»å…¥</span></div>
      </div>
    </div>

    <!-- MIDDLE -->
    <div class="mid">
      <div class="card">
        <div class="midHeader">
          <h1 id="pageTitle">é¦–é </h1>
          <div class="row">
            <button class="btn small" onclick="refresh()">åˆ·æ–°</button>
          </div>
        </div>

        <!-- FEED TOOLBAR -->
        <div id="feedToolbar" style="padding:12px 14px;border-bottom:1px solid var(--line)">
          <div class="row" style="justify-content:space-between;gap:10px;flex-wrap:wrap">
            <div class="subtabs">
              <button class="tab active" data-hot="day" onclick="setHot('day', this)">ç•¶æ—¥ç†±é–€</button>
              <button class="tab" data-hot="week" onclick="setHot('week', this)">æœ¬é€±ç†±é–€</button>
              <button class="tab" data-hot="month" onclick="setHot('month', this)">æœ¬æœˆç†±é–€</button>
              <button class="tab" data-hot="all" onclick="setHot('all', this)">ç¸½ç†±é–€</button>
            </div>
            <div class="row" style="gap:8px;min-width:min(460px,100%)">
              <input id="q" class="input" placeholder="æœå°‹é¡Œç›®..." onkeydown="if(event.key==='Enter'){refresh();}" />
              <button class="btn" onclick="refresh()">æœå°‹</button>
            </div>
          </div>
        </div>

        <!-- PAGES -->
        <div id="page_feed" class="feed"></div>

        <div id="page_predict" class="feed hide" style="padding:14px">
          <div class="notice">é€™è£¡å±•ç¤ºã€Œé æ¸¬åˆ—è¡¨ã€èˆ‡é»é€²è©³æƒ…ï¼ˆå·²ç”±é¦–é  feed é€£éå»ï¼‰ã€‚ç›®å‰ demo å…ˆç”¨é¦–é ã€‚</div>
        </div>

        <div id="page_publish" class="feed hide" style="padding:14px">
          <div class="col">
            <div class="notice">æŒ‰ä¸‹æŒ‰éˆ•æ¨¡æ“¬ã€Œçœ‹å»£å‘Šé ˜ 100 GCã€ã€‚å¾Œç«¯æœ‰ 12 å°æ™‚å†·å»ï¼ˆ/api/claim-adï¼‰ã€‚</div>
            <button class="btn primary" onclick="claimAd()">çœ‹å»£å‘Šæ‹¿é‡‘å¹£ï¼ˆ+100 GCï¼‰</button>
            <div id="claimMsg" class="notice hide"></div>
          </div>
        </div>

        <div id="page_profile" class="feed hide" style="padding:14px">
          <div class="col">
            <div class="notice">å€‹äººæª”æ¡ˆï¼ˆæš±ç¨±/ç°½å/å‹ç‡/ç­‰ç´š/GC/æœƒå“¡ç­‰ç´šï¼‰ã€‚ä¿®æ”¹æœƒæ‰“ /api/me PATCHã€‚</div>
            <div class="row" style="gap:12px;flex-wrap:wrap">
              <div style="flex:1;min-width:240px">
                <div class="muted" style="margin-bottom:6px">æš±ç¨±ï¼ˆ20å­—å…§ï¼‰</div>
                <input id="meNick" class="input" placeholder="Nick" />
              </div>
              <div style="flex:1;min-width:240px">
                <div class="muted" style="margin-bottom:6px">å€‹äººç°½åï¼ˆ140å­—å…§ï¼‰</div>
                <input id="meBio" class="input" placeholder="Bio" />
              </div>
            </div>

            <div class="row" style="gap:12px;flex-wrap:wrap">
              <div style="flex:1;min-width:160px">
                <div class="muted" style="margin-bottom:6px">æœƒå“¡ç­‰ç´š Tier</div>
                <input id="meTier" class="input" type="number" min="1" max="10" />
              </div>
              <div style="flex:1;min-width:160px">
                <div class="muted" style="margin-bottom:6px">ç­‰ç´š Level</div>
                <input id="meLevel" class="input" type="number" min="1" max="999" />
              </div>
              <div style="flex:1;min-width:160px">
                <div class="muted" style="margin-bottom:6px">é æ¸¬å‹ç‡ %</div>
                <input id="meWin" class="input" type="number" min="0" max="100" />
              </div>
              <div style="flex:1;min-width:160px">
                <div class="muted" style="margin-bottom:6px">é‡‘å¹£ GC</div>
                <input id="meGC" class="input" type="number" disabled />
              </div>
            </div>

            <div class="row" style="gap:10px;flex-wrap:wrap">
              <button class="btn primary" onclick="saveMe()">å„²å­˜</button>
              <button class="btn" onclick="loadMe()">é‡æ–°è¼‰å…¥</button>
              <span id="meMsg" class="notice hide"></span>
            </div>
          </div>
        </div>

        <div id="page_rules" class="feed hide" style="padding:14px">
          <div class="col">
            <div class="notice">
              <b>è¦å‰‡ & è¨­å®šï¼ˆçµ¦ä½¿ç”¨è€…çœ‹çš„ï¼‰</b><br><br>
              â€¢ GC æ˜¯å¹³å°å…§é»æ•¸ï¼Œä¸å¯å…Œæ›å›ä»»ä½•æ³•å¹£/ä»£å¹£ã€‚<br>
              â€¢ é æ¸¬åƒ…ä¾›å¨›æ¨‚èˆ‡ç¤¾ç¾¤äº’å‹•ï¼Œçµæœå¯èƒ½ä¸æº–ç¢ºã€‚<br>
              â€¢ åƒèˆ‡å‰è«‹è‡ªè¡Œè©•ä¼°é¢¨éšªï¼Œå‹¿æŠ•å…¥è¶…å‡ºæ‰¿å—ç¯„åœçš„ GCã€‚<br>
              â€¢ å¹³å°å¯èƒ½èª¿æ•´è¦å‰‡/åƒæ•¸ä»¥ç¶­è­·å…¬å¹³æ€§èˆ‡å®‰å…¨æ€§ã€‚<br>
            </div>
            <div class="row">
              <span class="pill">é¡¯ç¤ºè¨­å®š</span>
              <button class="btn" onclick="toggleTheme()">é–‹ç‡ˆ / é—œç‡ˆ</button>
              <button class="btn" onclick="fontSize(1)">å­—é«”+</button>
              <button class="btn" onclick="fontSize(-1)">å­—é«”-</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT: TAGS -->
    <div class="right">
      <div class="card rightBox">
        <h3>åˆ†é¡ TAG</h3>
        <div class="tagGrid" id="tagGrid"></div>
        <div class="sep"></div>
        <div class="notice">
          å°æé†’ï¼šç†±é–€æ’åºæ˜¯å¾Œç«¯ä¾ hot=day/week/month/all è¨ˆç®—ã€‚<br>
          é»é¡Œç›®å¯é€²å…¥è©³æƒ…é ï¼ˆdemo å…ˆç”¨å½ˆçª—é¡¯ç¤ºï¼‰ã€‚
        </div>
      </div>
    </div>

  </div>
</div>

<!-- AUTH MODAL -->
<div id="authBackdrop" class="modalBackdrop">
  <div class="modal">
    <div class="modalHeader">
      <b>ç™»å…¥ / è¨»å†Š</b>
      <button class="btn small" onclick="closeAuth()">âœ•</button>
    </div>
    <div class="modalBody">
      <div id="authMsg" class="notice hide"></div>

      <div class="col">
        <div>
          <div class="muted" style="margin-bottom:6px">Email</div>
          <input id="email" class="input" placeholder="you@example.com" autocomplete="email" />
        </div>
        <div>
          <div class="muted" style="margin-bottom:6px">Password</div>
          <input id="password" class="input" type="password" placeholder="è‡³å°‘ 6 ç¢¼" autocomplete="current-password" />
        </div>

        <div class="row" style="gap:10px;flex-wrap:wrap">
          <button class="btn primary" onclick="doLogin()">ç™»å…¥</button>
          <button class="btn" onclick="doRegister()">è¨»å†Š</button>
          <button class="btn ghost" onclick="closeAuth()">å–æ¶ˆ</button>
        </div>

        <div class="sep"></div>

        <div class="notice">
          <b>Google ç™»å…¥</b><br>
          ä½ å¾Œç«¯è‹¥å·²å®Œæˆ Google OAuth è·¯ç”±ï¼ˆä¾‹å¦‚ /api/auth/google/start /callbackï¼‰ï¼ŒæŠŠä¸‹é¢æŒ‰éˆ•çš„é€£çµæ”¹æˆä½ çš„è·¯ç”±å³å¯ã€‚
          å¦‚æœä½ å¾Œç«¯ç›®å‰é‚„æ²’æœ‰ Google OAuth è·¯ç”±ï¼Œå…ˆä¸è¦æŒ‰ä¹Ÿæ²’é—œä¿‚ã€‚
        </div>
        <button class="btn" onclick="googleStart()">ä½¿ç”¨ Google ç™»å…¥</button>
      </div>
    </div>
  </div>
</div>

<!-- DETAIL MODAL -->
<div id="detailBackdrop" class="modalBackdrop">
  <div class="modal">
    <div class="modalHeader">
      <b id="detailTitle">é¡Œç›®</b>
      <button class="btn small" onclick="closeDetail()">âœ•</button>
    </div>
    <div class="modalBody" id="detailBody"></div>
  </div>
</div>

<script>
/* =========================
   åŸºæœ¬è¨­å®š
========================= */
const API_BASE = "https://api.feex.win";

/* =========================
   1ï¸âƒ£ æ¥ä½ Google OAuth å›å‚³çš„ token
   Google callback æœƒå°åˆ°ï¼š
   https://feex.win/#token=xxxxx
========================= */
(function handleOAuthRedirect() {
  if (location.hash.startsWith("#token=")) {
    const token = decodeURIComponent(location.hash.slice(7));
    localStorage.setItem("token", token);
    // æ¸…æ‰ç¶²å€ä¸Šçš„ tokenï¼ˆæ¯”è¼ƒä¹¾æ·¨ï¼‰
    history.replaceState(null, "", location.pathname);
  }
})();

/* =========================
   2ï¸âƒ£ å–å¾—ç›®å‰ token
========================= */
function getToken() {
  return localStorage.getItem("token");
}

/* =========================
   3ï¸âƒ£ çµ±ä¸€çš„ API fetchï¼ˆè‡ªå‹•å¸¶ Authorizationï¼‰
========================= */
async function apiFetch(path, options = {}) {
  const token = getToken();

  const headers = {
    "Content-Type": "application/json",
    ...(options.headers || {})
  };

  if (token) {
    headers["Authorization"] = "Bearer " + token;
  }

  const res = await fetch(API_BASE + path, {
    ...options,
    headers,
  });

  const data = await res.json();
  if (!res.ok || data.ok === false) {
    throw new Error(data.error || "API error");
  }
  return data;
}

/* =========================
   4ï¸âƒ£ å–å¾—ç›®å‰ç™»å…¥ä½¿ç”¨è€…
========================= */
async function loadMe() {
  try {
    const res = await apiFetch("/api/me");
    renderUser(res.user);
  } catch (e) {
    renderGuest();
  }
}

/* =========================
   5ï¸âƒ£ ç™»å‡º
========================= */
function logout() {
  localStorage.removeItem("token");
  location.reload();
}

/* =========================
   6ï¸âƒ£ Google ç™»å…¥ï¼ˆæŒ‰éˆ•æœƒç”¨åˆ°ï¼‰
========================= */
function loginWithGoogle() {
  window.location.href = API_BASE + "/api/auth/google/start";
}

/* =========================
   7ï¸âƒ£ UI Renderï¼ˆä½ å¯ä»¥ä¾è‡ªå·± HTML æ”¹ï¼‰
========================= */
function renderUser(user) {
  document.getElementById("auth-area").innerHTML = `
    <div>
      <b>${user.nick}</b>ï¼ˆTier ${user.tier}ï¼‰
      ï½œGCï¼š${user.gc}
      <button onclick="logout()">ç™»å‡º</button>
    </div>
  `;
}

function renderGuest() {
  document.getElementById("auth-area").innerHTML = `
    <button onclick="loginWithGoogle()">ä½¿ç”¨ Google ç™»å…¥</button>
  `;
}

/* =========================
   8ï¸âƒ£ é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
========================= */
document.addEventListener("DOMContentLoaded", () => {
  loadMe();
});
</script>

</body>
</html>
